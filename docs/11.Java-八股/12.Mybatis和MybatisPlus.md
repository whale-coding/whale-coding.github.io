---
title: Mybatis和MybatisPlus
date: 2025-03-06 21:25:02
permalink: /pages/4140da
categories:
  - 八股-Java
  - 开发框架
---

### 1.MyBatis中#{}和${}的区别是什么？

参考资料：https://blog.csdn.net/Ahuuua/article/details/113352377

:::note

- `#{}`是预编译处理，`${}`是字符串替换；
- `#{}`使用SQL 参数绑定机制，可以有效防止 SQL 注入；`${}`参数是直接拼接到 SQL 中，容易导致 SQL 注入问题；
- `#{}`用于大部分场景下的SQL语句中的值，`${}`常用于动态拼接表名或列名等场景。

:::

>扩展面试题：**哪些场景会使用到${} ？**

:::danger NOTE

:::

>扩展面试题：**必须使用${}的场景如何避免SQL注入？**

:::danger NOTE

要提前对参数进行安全性校验。对用户输入进行验证和过滤，只允许输入预期的数据，不允许输入特殊字符或 SQL 关键字。

:::

### 2.介绍一下Mybatis的一级和二级缓存？

:::note

Mybatis的一级缓存是**默认缓存机制**，无需任何配置，缓存作用域是**SqlSession**。同一个SqlSession 中，相同的查询会缓存结果，避免重复查询数据库。

一级缓存在SqlSession 关闭或销毁、执行更新操作和手动清空缓存等场景下会失效。

二级缓存是 **Mapper 级别**的缓存，可以跨 SqlSession 共享，需要在`mybatis-config.xml`全局配置文件中手动开启以及在Mapper 的 XML 文件中加`<cache/>`标签才会生效。

二级缓存会随着执行更新操作和手动清空缓存而失效。

:::

### 3.Mapper接口的工作原理是什么？

:::note

Mapper接口的工作原理是：Mapper 接口 和 XML 映射文件 是一一对应的关系。Mapper接口的全限名，就是Mapper映射文件中的 namespace 的值，接口的方法名，就是映射文件中 `MappedStatement` 的 id 值，接口方法内的参数，就是传递给 sql 的参数。

Mapper接口的底层原理是 JDK 动态代理，MyBatis 运行时会使用 JDK 动态代理为 Mapper 接口生成代理 proxy 对象，代理对象 proxy 会拦截接口方法，转而执行 `MappedStatement` 所代表的 sql，然后将 sql 执行结果返回。

:::

>扩展面试题：Mapper接口和XML是如何绑定的？

:::danger NOTE

:::

### 4.MyBatis 动态 sql 是做什么的？都有哪些动态 sql？简述动态 sql 的执行原理？

:::note

 MyBatis的动态 sql允许我们在xml映射文件中以标签的形式编写sql，完成逻辑判断和动态拼接 sql 的功能。

 MyBatis提供的动态sql标签有：`<if>`、`<where>`、`<choose>`、`<foreach>`、`<bind/>`、`trim`、`set`。

动态sql的执行原理是使用 OGNL 从 sql 参数对象中计算表达式的值，根据表达式的值动态拼接 sql，来完成动态 sql 的功能。

:::

### 5.MyBatis 是如何进行分页的？分页插件的原理是什么？

:::note

MyBatis中实现分页可以通过三种方式：

- 使用 RowBounds 对象进行分页，它是针对 ResultSet 结果集执行的内存分页，而非物理分页；
- 在 sql 内直接书写带有物理分页的参数来完成物理分页功能；
- 使用分页插件如PageHelper来完成物理分页。

分页插件的原理是使用 MyBatis 提供的插件接口，实现自定义插件，在插件的拦截方法内拦截待执行的 sql，然后重写 sql，根据 dialect 方言，添加对应的物理分页语句和物理分页参数。

:::

### 6.Mybatis的Mapper中的方法可以重载吗？为什么？

:::note

Mapper接口的方法**不能重载**，虽然在Java中方法重载是允许的，但MyBatis使用“全限定类名+方法名”来唯一标识一个SQL语句，这会导致重载的方法无法被正确识别和映射。 

:::

### 7.Mybatis有哪些常用标签？

:::note



:::



### 8.Mybatis和MybatisPlus有什么区别？

:::note

MyBatis是半自动 ORM 框架，需要手动编写 SQL，MyBatis-Plus是在 MyBatis 的基础上进行扩展和增强，提供大量开箱即用功能，帮助提升开发效率。

Mybatis的灵活性高，支持复杂 SQL 和存储过程；MyBatis-Plus提供了通用 CRUD 接口和代码生成器，对于单表的 CRUD 操作，我们可以使用内置的方法来简化开发。

MyBatis-Plus还提供了丰富的插件，如分页插件、逻辑删除插件等，也兼容MyBatis，对于复杂的SQL我们通常还是采用XML编写的方式。

:::



## 开发小知识点

>1.在 mapper 中如何传递多个参数？

- 顺序传参法
- @Param 注解传参法
- Map 传参法
- Java Bean 传参法

>2.实体类属性名和表中字段名不一样 ，怎么办?

- 第 1 种： 通过在查询的 SQL 语句中定义字段名的别名，让字段名的别名和实体类的属性名一致。
- 第 2 种： 通过 resultMap 中的`<result>`来映射字段名和实体类属性名的一一对应的关系。

>3.模糊查询 like 语句该怎么写?

- `"%"#{question}"%"`，注意`%` 需要使用双引号`" "`，不能使用单引号 `''`。
- `CONCAT('%',#{question},'%')`，使用 `CONCAT()`函数。

> 4.Mybatis 能执行一对一、一对多的关联查询吗？

- 一对一、多对一：`<association>`
- 一对多、多对多：`<collection>`

> 5.如何获取生成的主键?

在insert 标签中使用`userGeneratedKeys`和`keyProperty标签`。

> 6.MyBatis 如何执行批量操作？

使用 foreach 标签。

> 8.为什么 Mapper 接口不需要实现类？

动态代理。

> 9.什么是SQL注入？如何防止SQL注入？

SQL注入是一种常见的网络安全漏洞，web应用程序对用户输入数据的合法性没有判断或过滤不严，攻击者可以在web应用程序中事先定义好的查询语句的结尾上添加额外的SQL语句，在管理员不知情的情况下实现非法操作。

比如一个SQL是：`delete from user where id = " + "id"`

这个id从请求参数中获取，若参数被拼接为：

```
"1001 or  1 =1 "
```

最后执行SQL语句变为：`delete from user where id = 1001 or 1 = 1`

结果数据库的数据都会被清空掉，后果非常严重。

**如何防止** **SQL** **注入：**

- 使用`PreparedStatement`对象。
- mybatis中使用`#{}`。
- 对用户输入进行验证和过滤，只允许输入预期的数据，不允许输入特殊字符或 SQL 关键字。

> 10.前端传来in(a,b,c)，这种SQL怎么写？
